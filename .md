# Notion Task Bot

自然な日本語でタスク管理ができるSlackボット。3層構造（ルールベース+軽量AI+検証ルール）を採用し、柔軟かつ確実な対話を実現します。

## システムアーキテクチャ

### 3層構造の概要

```python
第1層：ルールベース（基本解析）
┣ 確実な情報の抽出
┣ パターンマッチング
┗ 基本的な文章理解

第2層：軽量AI（補助解析）
┣ 曖昧な表現の解釈
┣ 文脈の理解
┗ 意図の推測

第3層：検証ルール（最終判断）
┣ 結果の妥当性確認
┣ エラーチェック
┗ 最終的な決定
```

### 第1層：ルールベース処理
基本的な情報抽出を担当する高速で確実な処理層

#### 処理内容
1. 日付処理
   - 絶対日付: `5月20日`、`2024/3/1`
   - 相対日付: `明日`、`来週`、`今週末`
   - 期間指定: `3日後`、`一週間以内`

2. カテゴリ認識
   - 科目名の直接マッチ（数学、英語）
   - 関連キーワード（計算→数学）
   - 定型の科目表現（〜の課題）

3. 優先度判定
   - 明確な優先表現（重要、急ぎ）
   - 期限との関連付け（今日中→高優先）
   - 定型の重要度表現（必ず、絶対）

#### 性能要件
- 処理速度：0.1秒以内
- 信頼度：90%以上必要

### 第2層：軽量AI処理
曖昧な表現の解釈を担当する補助的な処理層

#### 処理対象
1. 曖昧な表現
   - `そろそろやらないと` → 期限：近日
   - `ちょっと急いでる` → 優先度：中〜高
   - `結構重要` → 優先度：中〜高

#### 使用技術
- Word2Vec（単語の類似性）
- 決定木（シンプルな分類）
- TF-IDF（キーワード重要度）

#### システム要件
- メモリ使用：100MB以下
- 処理時間：0.3秒以内
- モデルサイズ：50MB以下

#### 学習データ管理
- 基本セット：1000件程度
- 定期更新：週1回
- フィードバック反映：日次

### 第3層：検証処理
結果の確認と最終判断を行う制御層

#### 検証内容
1. 基本チェック
   - 必須項目の存在確認
   - 日付の妥当性
   - カテゴリの有効性

2. 整合性チェック
   - 期限と優先度の矛盾チェック
   - カテゴリとタスク内容の一致
   - 重複タスクの検出

3. 判断基準
   - ルールベース > AI判断
   - 確実な情報を優先
   - あいまいな場合は確認

## 処理フロー

### 基本フロー
```python
入力テキスト
↓
1. ルールベース処理
   - 基本情報の抽出
   - 確実な要素の特定
   ↓
2. 不明点のAI解析
   - 曖昧な表現の解釈
   - 文脈からの推測
   ↓
3. 最終検証
   - 全情報の整合性確認
   - ルールに基づく修正
   ↓
結果確定
```

### エラー処理フロー
1. 情報不足時
   ```python
   ルールベース：必須情報の欠落を検出
   AI：補完案を提示
   検証：確認が必要と判断
   ⇒ ユーザーに確認
   ```

2. 曖昧な表現時
   ```python
   ルールベース：解釈不能を検出
   AI：可能性のある解釈を提示
   検証：複数の候補から選択
   ⇒ 選択肢を提示
   ```

3. 矛盾発生時
   ```python
   ルールベース：基本矛盾を検出
   AI：解決案を提示
   検証：優先規則を適用
   ⇒ 自動的に調整
   ```

## 使用例

### 例1：明確な指示の処理
```
入力：「明日までに数学のレポート提出」
1. ルールベース
   ✓ 期限：明日
   ✓ カテゴリ：数学
   ✓ タスク名：レポート提出
2. AI処理：不要
3. 検証：OK
```

### 例2：曖昧な表現の処理
```
入力：「数学のレポート、けっこう急いでる」
1. ルールベース
   ✓ カテゴリ：数学
   ✓ タスク名：レポート
   ? 優先度：不明
2. AI処理
   入力：「けっこう急いでる」
   結果：優先度「中」
3. 検証
   ⇒ 期限情報なし + 急ぎ表現あり
   ⇒ 優先度を「高」に修正
```

## 開発ロードマップ

### Phase 1：ルールベース実装（1-2週間）
1. 基本的なパターンマッチング
2. 日付処理の実装
3. カテゴリ・優先度の判定

### Phase 2：検証ルール実装（1週間）
1. 基本チェック機能
2. 整合性検証
3. エラー処理

### Phase 3：軽量AI導入（2-3週間）
1. 基本モデルの実装
2. 学習データの準備
3. 統合テスト

## 評価指標

### 性能指標
- 応答時間：1秒以内
- メモリ使用：最大300MB
- CPU使用率：ピーク時50%以下

### 精度指標
- ルールベース処理：95%以上
- AI処理：80%以上
- 最終判断：90%以上

### 改善指標
- フィードバック対応率
- エラー検出率
- ユーザー満足度

